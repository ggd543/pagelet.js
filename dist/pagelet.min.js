!function(a){"use strict";function b(){}function c(a){var b=r.createElement("script");e(b,r.createTextNode(a)),e(s,b)}function d(a){return!!a}function e(a,b){return a.appendChild(b)}function f(a,b){return a.hasOwnProperty(b)}function g(a,b){return a.getAttribute(b)}function h(a,b){return Object.prototype.toString.call(a).toLowerCase()==="[object "+b+"]"}function i(a,c,d){var f,g="js"===c,h="css"===c,i=r.createElement(g?"script":"link"),j="onload"in i,k=setTimeout(function(){clearTimeout(k),clearInterval(f),d("timeout")},o);g?(i.type="text/javascript",i.async="async",i.src=a):(h&&(i.type="text/css",i.rel="stylesheet"),i.href=a),i.onload=i[m]=function(){!i||i[n]&&!/loaded|complete/.test(i[n])||(clearTimeout(k),i.onload=i[m]=b,g&&s&&i.parentNode&&s.removeChild(i),d(),i=null)},i.onerror=function(b){clearTimeout(k),clearInterval(f),b=(b||{}).error||new Error("load resource timeout"),b.message="Error loading ["+a+"]: "+b.message,d(b)},e(s,i),h&&(q||!j)&&(f=setInterval(function(){i.sheet&&(clearTimeout(id),clearInterval(f),d())},20))}function j(a){var b={};a.emit=function(c){var d=b[c],e=[].slice.call(arguments);e.shift(),d&&d.forEach(function(b){b.apply(a,e)})},a.on=function(a,c){var d=b[a];!d&&(d=b[a]=[]),!~d.indexOf(c)&&d.push(c)},a.off=function(a,c){if(arguments.length>=2)b[a]=null;else{var d=b[a];if(!d)return;var e,f=[];b[a]=d.forEach(function(a){a===c?e=!0:f.push(a)}),e&&(b[a]=f)}return this}}function k(a,b,c){if(b&&b.length&&(b=b.filter(function(a){var b=w[a]===!0;return w[a]=!0,!b}),b.length))if(v){var d=b.join(",");a.push({uri:u.replace("%s",d),type:c})}else b.forEach(function(b){a.push({uri:b,type:c})})}var l,m="onreadystatechange",n="readyState",o=6e4,p="/co??%s",q=+navigator.userAgent.replace(/.*AppleWebKit\/(\d+)\..*/,"$1")<536,r=document,s=r.head||r.getElementsByTagName("head")[0];i.xhr=function(){return l},i.request=function(c,d,e,f){var g=d.before||b;l&&l[n]<4&&(l[m]=b,l.abort()),l=new a.XMLHttpRequest,l.onprogress=f,l[m]=function(){if(4==l[n]){l[m]=b;var a,c=null;if(l.status>=200&&l.status<300||304==l.status){a=l.responseText;try{a=JSON.parse(a)}catch(d){c=d}c?e(c):e(null,a)}else c=l.statusText||(l.status?"error":"abort"),e(c)}},g(l),l.open("GET",c,!0),l.send()};var t=a.history,r=document,u=p,v=!1,w={},x=t&&t.pushState&&t.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/),y=a.pagelet={};j(y),y.init=function(a,b,c){v=!!a,u=b||p,c&&c.length&&c.forEach(function(a){w[a]=!0})},y.load=function(a,d,e,f){if(d&&d.length){e=e||b,f=f||b,h(d,"string")&&(d=d.split(/\s*,\s*/));var g=a+(-1===a.indexOf("?")?"?":"&")+"pagelets="+encodeURIComponent(d.join(","));i.request(g,{before:function(a){y.emit("beforeload",d,a)}},function(a,f){if(y.emit("loadend",d,a,f),a)return e(a);r.title=f.title||r.title;var g=[];k(g,f.js,"js"),k(g,f.css,"css");var h=function(){if(f.script&&f.script.length){var a="!function(){",d="}();\n",e=a+f.script.join(d+a)+d;c(e)}h=b},j=a;if(g&&g.length){var l=g.length;g.forEach(function(a){i(a.uri,a.type,function(a){l--,0===l&&e(j,f,h),j=a})})}else e(j,f,h)},f)}else location.href=a};var z;y.go=function(b,c,d,e){if(x&&c){z||(z={url:a.location.href,title:r.title},t.replaceState(z,r.title)),y.load(b,c,function(a,c,e){var f=c.title||r.title;z={url:b,title:f},t.replaceState(z,f,b);try{r.activeElement.blur()}catch(g){}d(null,c.html)!==!1&&e()},e);var f=i.xhr();f&&f.readyState>0&&t.pushState(null,"",b)}else location.href=b},y.autoload=function(){a.addEventListener("popstate",function(a){z=a.state,z&&(location.href=z.url)},!1),r.documentElement.addEventListener("click",function(a){var b=a.target;if("a"===b.tagName.toLowerCase()){if(a.which>1||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)return;if(location.protocol!==b.protocol||location.hostname!==b.hostname)return;var c=g(b,"data-pagelets"),e=g(b,"data-parents"),h=g(b,"data-autocache"),i=g(b,"href");if(c=(c||"").split(/\s*,\s*/).filter(d),e=(e||"").split(/\s*,\s*/).filter(d),i&&e.length===c.length&&c.length>0){if(a.preventDefault(),a.stopPropagation(),"cached"===h)return!1;"false"===h&&(i+=(i.indexOf("?")>=0?"&":"?")+"_ts="+Date.now());var j={};c.forEach(function(a,b){j[a]=e[b]}),y.go(i,c,function(a,c){if(a)throw new Error(a);for(var d in c)if(f(c,d)&&f(j,d)){var e=j[d],g=r.getElementById(e);if(!g)throw new Error("undefined parent dom ["+e+"]");g=null,"true"===h&&b.setAttribute("data-autocache","cached")}})}}},!1)}}(window);